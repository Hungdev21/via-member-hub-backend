name: Notify on Push

on:
  push:
    branches:
      - staging
      - main
      - backend-setup

jobs:
  notify:
    runs-on: [self-hosted, windows]
    steps:
      - name: Send Slack message
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        shell: powershell
        run: |
          $actor = "${{ github.actor }}"
          $repo = "${{ github.repository }}"
          $commitMsg = "${{ github.event.head_commit.message }}"
          $commitHash = "${{ github.event.head_commit.id }}"
          $commitUrl = "https://github.com/$repo/commit/$commitHash"
          
          $message = @{
            text = "ğŸ“¦ Push Notification`nğŸ‘¤ By: $actor`nğŸ“ Repo: $repo`nğŸ“ Message: $commitMsg`nğŸ”— Commit: $commitUrl"
          } | ConvertTo-Json -Compress
          
          Write-Host "Sending message to Slack..."
          Invoke-RestMethod -Uri $env:SLACK_WEBHOOK_URL -Method Post -Body $message -ContentType 'application/json'
